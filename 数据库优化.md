# 数据库优化

## 1、索引是什么

​			类似于书的目录，我们可以通过索引来快速定位想要查看的内容所在的页面，也就是位置。

​			索引是一种数据结构。

## 2、索引作用

​			合理的使用索引，可以对数据库查询效率做出很大的优化，提高数据库查询速度。

​			缺点：

​			1、索引会降低表更新操作，在更新表时，MySQL不仅要更新数据，还要更新索引文件。

​			2、建立索引会占用磁盘空间。对大量数据建立不合理地建立索引，会使得索引文件非常大，结果适得其反，花了空间，还没有优化查询。

## 3、索引的用法

### 1>普通索引

```sql
//添加索引：普通， 唯一， 主键
alter table table_name add index index_name (column_list)
alter table table_name add unique (column_list)
alter table table_name add primary key (column_list)

//创建索引
create index index_name on tabale_name(column_list)
create unique index index_name on table_name (column_list)

//删除索引
drop index index_name on table_name
alter table table_name drop index index_name
alter table table_name drop primary key
```

### 2>组合索引、前缀索引

```
//联合索引，过多的联合索引反而会影响查询效率
alter table table_name add index index_name (feild_name, feild_name, feild_name)
```

​	组合索引查询遵循最左前缀索引规则，如果查询条件中不包括最左端的索引字段，那么表查询将不会使用索引查询。

### 3> sql 查询分析

```sql
expain select * from table_name where id=1;
```

### 4>索引使用技巧

- 不包含 NULL 列，也就是被建立索引的列都是被 NOT NULL 修饰的列。NULL 列索引无效。

- 短索引，列中数据有长度时，如果数据前 10-20 个字符内，数值唯一，就不对整列创建索引，而使用 char（10-20）来建立短索引。可以提高查询速度，节省空间和 IO 操作。

- 索引列排序，mysql查询只使用一个索引，因此如果where子句中已经使用了索引的话，那么order by中的列是不会使用索引的。因此数据库默认排序可以符合要求的情况下不要使用排序操作，尽量不要包含多个列的排序，如果需要最好给这些列建复合索引。

- like语句操作

  ​      一般情况下不鼓励使用like操作，如果非使用不可，注意正确的使用方式。like ‘%aaa%’不会使用索引，而like ‘aaa%’可以使用索引。

- 不要在列上进行运算

- 不使用NOT IN 、<>、！=操作，但<,<=，=，>,>=,BETWEEN,IN是可以用到索引的，索引在非操作中不会使用。

- 索引要建立在经常进行 select 操作的字段上。 这是因为，如果这些列很少用到，那么有无索引并不能明显改变查询速度。相反，由于增加了索引，反而降低了系统的维护速度和增大了空间需求。

- 索引要建立在值比较唯一的字段上。

- 对于那些定义为 text、image 和 bit 数据类型的列不应该增加索引。因为这些列的数据量要么相当大，要么取值很少。

- 在where和join中出现的列需要建立索引。

- 如果where字句的查询条件里使用了函数(如：where DAY(column)=…),mysql将无法使用索引。

- 在join操作中(需要从多个数据表提取数据时)，mysql只有在**主键和外键的数据类型相同**时才能使用索引，否则及时建立了索引也不会使用。



## 4、分库分表

### 分为两个模式

#### 1、client 模式

​		阿里的 TDDL 

![分库分表_client](D:\Java\笔记\分库分表_client.jpg)

#### 2、proxy 模式

​		阿里的 cobar ， 开源的 MyCat

![分库分表_proxyjpg](D:\Java\笔记\分库分表_proxyjpg.jpg)



## 5、count（）和 limit（）优化

### 1、为什么需要优化

由于 limit 在查询

### 2、如何优化